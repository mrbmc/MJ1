package com.whtn {	import flash.display.MovieClip;	import flash.events.Event;	import flash.events.MouseEvent;	import flash.text.TextFormat;	import flash.text.TextField;	import fl.controls.Slider;	import fl.controls.SliderDirection;	import fl.controls.NumericStepper;	import fl.controls.CheckBox;	import fl.controls.RadioButton;	import fl.controls.RadioButtonGroup;	import com.whtn.Tube;	import com.whtn.Sequencer;	import com.whtn.DebugEvent;	public class MJ1UI extends MovieClip {		var myFormat:TextFormat = new TextFormat();		public static var MAX_ROTATION:Number = 180;		public var globalBrightness = 100;		public var sequencer:Sequencer = new Sequencer();		public var cbBlank:RadioButton = new RadioButton();		public var cbSyncBanks:RadioButton = new RadioButton();		public var cbReflectBanks:RadioButton = new RadioButton();		public var rbgBanks:RadioButtonGroup = new RadioButtonGroup("bankGroup");				public var cbLoop:CheckBox = new CheckBox();		public var cbReflect:CheckBox = new CheckBox();		public var cbReverse:CheckBox = new CheckBox();		public var cbLockSlidersL:CheckBox = new CheckBox();		public var cbLockSlidersR:CheckBox = new CheckBox();
		public var cbColorShift:CheckBox = new CheckBox();
				public var loop:Boolean = false;		public var reflect:Boolean = false;		public var reverse:Boolean = false;				private function _trace (o:Object):void {			dispatchEvent(new DebugEvent(o));		}		public function MJ1UI ():void {			super();			sequencer.device = 'mj1';			sequencer.addEventListener('blackout',blackout);			myFormat.font = "_sans";			myFormat.size = 10;			myFormat.color = 0xFFFFFF;			var tube:Tube;// = new MovieClip();			var w = 180;			var h = 33;			var row = 0;			var rows = 8;			var steps = 12;			for (i=0;i<(rows*2);i++) {				var c = (i<8) ? 0xFF0000 : 0x0000FF				tube = new Tube(i,w,h,90,c)				//tube.id = "tube" + i;				tube.x = (Math.floor(i/rows)*(320));				tube.y = (i%rows)*(h+5);				addChild(tube);				tube.addEventListener("tube",tubeEventHandler);			}				cbBlank.move(240,0);				cbBlank.label = "Break";				cbBlank.setStyle("textFormat", myFormat);				cbBlank.addEventListener(MouseEvent.CLICK, parameterHandler);			addChild(cbBlank);				cbSyncBanks.move(240,20);				cbSyncBanks.label = "Sync";				cbSyncBanks.addEventListener(MouseEvent.CLICK, parameterHandler);				cbSyncBanks.setStyle("textFormat", myFormat);				cbSyncBanks.selected = true;			addChild(cbSyncBanks);				cbReflectBanks.move(240,40);				cbReflectBanks.label = "Reflect";				cbReflectBanks.addEventListener(MouseEvent.CLICK, parameterHandler);				cbReflectBanks.setStyle("textFormat", myFormat);			addChild(cbReflectBanks);			cbBlank.group = cbSyncBanks.group = cbReflectBanks.group = rbgBanks; 				cbLoop.move(240,90);				cbLoop.label = "Loop";				cbLoop.addEventListener(MouseEvent.CLICK, parameterHandler);				cbLoop.setStyle("textFormat", myFormat);			addChild(cbLoop);				cbReflect.move(240,120);				cbReflect.label = "Reflect";				cbReflect.addEventListener(MouseEvent.CLICK, parameterHandler);				cbReflect.setStyle("textFormat", myFormat);			addChild(cbReflect);				cbReverse.move(240,150);				cbReverse.label = "Reverse";				cbReverse.addEventListener(MouseEvent.CLICK, parameterHandler);				cbReverse.setStyle("textFormat", myFormat);			addChild(cbReverse);				cbColorShift.move(240,180);
				cbColorShift.label = "Color Shift";
				cbColorShift.addEventListener(MouseEvent.CLICK, parameterHandler);				cbColorShift.setStyle("textFormat", myFormat);			addChild(cbColorShift);
			function parameterHandler(e:MouseEvent) {				dispatchEvent(new Event("change"));			}							cbLockSlidersL.move(0,-30);				cbLockSlidersL.label = "lock";				cbLockSlidersL.addEventListener(MouseEvent.CLICK, lockSliders);				cbLockSlidersL.setStyle("textFormat", myFormat);				cbLockSlidersL.selected = true;			addChild(cbLockSlidersL);				cbLockSlidersR.move(320,-30);				cbLockSlidersR.label = "lock";				cbLockSlidersR.addEventListener(MouseEvent.CLICK, lockSliders);				cbLockSlidersR.setStyle("textFormat", myFormat);				cbLockSlidersR.selected = true;			addChild(cbLockSlidersR);			function lockSliders(e:MouseEvent) {			}						var pickerL:Picker = new Picker('colorLeft',0xFFFFFF,245,100);				pickerL.y = (h+5) * rows;				pickerL.x = 0;				pickerL.addEventListener("color",onColor);				addChild(pickerL);			var pickerR:Picker = new Picker('colorRight',0xFFFFFF,245,100);				pickerR.y = (h+5) * rows;				pickerR.x = 320;				pickerR.addEventListener("color",onColor);				addChild(pickerR);			function onColor (e:ColorEvent) {				var min = (e.targetName=="colorLeft" || cbSyncBanks.selected) ? 0 : 8;				var max = (e.targetName=="colorRight" || cbSyncBanks.selected) ? 16 : 8;				var display = [];				//dispatchEvent(new DebugEvent('color('+e.color+')'));				for(i = min;i < max;i++) {					var target_mc = getChildByName('tube' + i);						target_mc.color = e.color;					Drawing.setColor(target_mc.lite,e.color);					display.push(new TubeSet(i,-1,-1,e.color));				}				//trace(Math.abs(Drawing.hex2hsv(e.color).h));				dispatchEvent(new TubeEvent(display));			}		}		function bankHandler(e:TubeEvent) {		}		function tubeEventHandler(e:TubeEvent) {			if(e.index is Array) {				return trace("Whoa whoa whoa");			}			var min = e.index * 1;			var max = e.index * 1;			var comp = false;			if(this.cbSyncBanks.selected) {				min = 0;				max = 15;				comp = true;			} else if(cbReflectBanks.selected) {				min = 0;				max = 15;			} else if (e.index<8 && cbLockSlidersL.selected) {				min = 0;				max = 7;				comp = true;			} else if(e.index >= 8 && cbLockSlidersR.selected) {				min = 8;				max = 15;				comp = true;			}			//if(comp) {				e.stopPropagation();				var display = [];				for(i=min;i<=max;i++) {					var pos = e.settings.position;					if(cbReflectBanks.selected) {						pos = ((e.index<8 && i>=8) || (e.index>=8 && i<8)) ? Math.abs(e.settings.position - MJ1UI.MAX_ROTATION) : e.settings.position;					}					display[i] = new TubeSet(i,e.settings.brightness,pos,e.settings.color);					getChildByName('tube'+i).update(display[i]);				}				dispatchEvent(new TubeEvent(display));			//}		}				public function blackout (e:Event):void {			var display = [];			for(i=0;i<16;i++) {				getChildByName('tube'+i).trigger.lite.alpha = 0;				display.push(new TubeSet(i,-1,90,0x000000));			}			dispatchEvent(new TubeEvent(display));		}		public function update (e:TubeEvent):void {			if(e.index is Array){				for(i in e.index) {					getChildByName('tube' + i).update(e.index[i]);				}			} else if (e.index is TubeSet) {				getChildByName('tube' + e.index).update(e);			}		}	}//class}